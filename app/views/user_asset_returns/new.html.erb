<% provide(:title, "New Return Items") %>

<% if flash[:errors] %>
<div class="alert alert-danger">
<ul>
  <% flash[:errors].each do |error| %>
    <li><%= error %></li>
    <% end %>
</ul>
</div>
<% end %>

<div class="container8">
<div class="form2">
<div class="font-edit font-left">
<h2>New Return Items</h2>
</div>
    <%= form_with model: @asset_return, url:  user_asset_returns_path, method: :post, format: :json do |f| %>
    <div class="font-user">
    <hr>
      <p>
      <%= f.label :code, class:"tlabel" %>
      <%= f.text_field :code, value: @asset_return.code, readonly:true, class:"textbox2" %>
      </p>
      <p>
      <%= f.label :asset_loan_id, class:"tlabel" %>
      <%= f.text_field :asset_loan_id, value: @asset_return.asset_loan.code, readonly: true, class:"textbox2"  %>
      </p>
      <p>
      <%= f.label :user, class:"tlabel" %>
      <%= f.text_field :user_id, value: @current_user_name, readonly: true, class:"textbox2" %>
      </p>
      <p>
      <%= f.label :actual_return_datetime, class:"tlabel" %>
      <span id='ct5'>
      </span>
      </p>
      </div>

      <div class="font-return font-left">
      <h2>Asset Return Items</h2>
      </div>
      <hr>
      <table class= "table-return table-hover">
        <thead>
          <th class="tlabel2">Item</th>
          <th class="tlabel2">Actual Condition</th>
          <th class="tlabel2">Action</th>
        </thead>

        <tbody>
            <% @asset_return.asset_return_items.each_with_index do |item, index| %>
              <tr id="item-row-<%= index %>">
                <td>
                  <%= f.hidden_field "asset_return_items[#{index}][item_id]", value: item.item_id %>
                  <%= text_field_tag nil, item.item_name, readonly: true, style: "width: 325px;", class: "textbox2" %>
                </td>
                <td>
                  <%= f.select "asset_return_items[#{index}][actual_item_condition]",
                      options_for_select(['good', 'damage', 'unusable'], item.actual_item_condition), {}, style: "width: 325px" %>
                </td>
                <td>
                  <button class="btn btn-danger delete-item btn-del" data-item-id="<%= index %>">Delete</button>
                </td>
              </tr>
          <% end %>
        </tbody>
      </table>

    <script>
      // Add an event listener to the delete buttons
        document.querySelectorAll('.delete-item').forEach(function(button) {
          button.addEventListener('click', function(event) {
          event.preventDefault();

        // Get the item ID from the data attribute
          var index = button.getAttribute('data-item-id');
          console.log("Destroy button clicked for index: " + index);

        // Find the corresponding item row and remove it from the DOM
          var itemRow = document.getElementById('item-row-' + index);
          if (itemRow) {
            itemRow.remove();
          }
          });
        });

        function display_ct5() {
          var x = new Date()
          var ampm = x.getHours( ) >= 12 ? ' PM' : ' AM';

          var x1=x.getFullYear() + '-' + (x.getMonth() + 1) + '-' + x.getDate();
          x1 = x1 + " " +  x.getHours( )+ ":" +  x.getMinutes() + ":" +  x.getSeconds() + ampm;
          document.getElementById('ct5').innerHTML = x1;
          display_c5();
           }
           function display_c5(){
          var refresh=100; // Refresh rate in milli seconds
          mytime=setTimeout('display_ct5()',refresh)
          }
          display_c5()
    </script>

    <p>
    <%= f.submit "CREATE", class: "button4 btn btn-primary btn-lg" %>
    </p>

    <% end %>

    </div>
</div>