<% provide(:title, "Asset Loans") %>
<div class="form">
<br>
<div class="container9 mb-4">
<h1 class="pb-0 mb-2">Loan Item</h1>

<% if flash[:success] %>
  <div class="alert alert-success">
    <%= flash[:success] %>
  </div>
<% end %>

<% if flash[:errors] %>
  <div class="alert alert-danger">
    <%= flash[:errors] %>
  </div>
<% end %>

<div class="table-responsive w-100 mb-5">
<table class="table borderless w-100 mb-5">
  <tr>
  <td><%= button_to new_user_asset_loan_path, method: 'get', class: "button2 btn btn-primary" do %>
    <span class="fa-solid fa-plus" aria-hidden="true"></span>
    New Loan
  <% end %>
  </td>
  <td><%= link_to export_loan_asset_loans_items_path(format: :csv), download: 'export_data.csv',
       id: 'export-csv-link',
       class: 'button8 btn btn-info text-light',
       :format => 'csv' do %>
       <span class="fa-solid fa-download" aria-hidden="true"></span>
       Export Loans
       <% end %>
  </td>
    <td>
      <div class="table-container">
        <%= form_tag asset_loans_items_path, method: 'get' do %>
          <div class="input-group mx-1 search">
            <%= text_field_tag :search, params[:search], placeholder: 'Type here...', class: "form-control search-box" %>
            <span class="input-group-btn">
              <%= button_tag(type: "submit", class: "btn btn-secondary search-button") do %>
                <i class="fa fa-search"></i>
              <% end %>
            </span>
            </div>
        <% end %>
    </td>
  </tr>
</table>

<table id="myTable" class="table table-bordered table-item w-100 center vcenter">
  <thead class="thead">
    <tr>
      <th onclick="sortTable(0)" class="th vcenter text-nowrap">Code <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(1)" class="th vcenter text-nowrap">Item Name <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(2)" class="th vcenter text-nowrap">Item Code <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(3)" class="th vcenter text-nowrap">User <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(4)" class="th vcenter text-nowrap">Loan Date <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(5)" class="th vcenter text-nowrap">Return Estimation Date <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(6)" class="th vcenter text-nowrap">Item Condition <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(7)" class="th vcenter text-nowrap">Necessary <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(8)" class="th vcenter text-nowrap">Admin <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(9)" class="th vcenter text-nowrap">Loan Status <i class="fa fa-fw fa-sort"></th>
      <th onclick="sortTable(10)" class="th vcenter text-nowrap">Reason <i class="fa fa-fw fa-sort"></th>
    </tr>
  </thead>
  <tbody>
  <%  @loan_items.each do |loan| %>
      <tr>
        <td class="col-sm-1 text-left"><%= link_to loan.asset_loan.code, asset_loans_item_path(loan) %></td>
        <td class="col-sm-2"><%= loan.item.name %></td>
        <td class="col-sm-1"><%= loan.item.code %></td>
        <td class="col-sm-1"><%= loan.asset_loan.user.name %></td>
        <td class="col-sm-1"><%= loan.asset_loan.loan_item_datetime.strftime("%Y-%m-%d %H:%M") %></td>
        <td class="col-sm-1"><%= loan.asset_loan.return_estimation_datetime.strftime("%Y-%m-%d %H:%M") %></td>
        <td>
        <% if loan.item.condition == "layak pakai" %>
          <span class="badge rounded-pill bg-success"><%= loan.item.condition %></span>
        <% elsif loan.item.condition == "layak pakai ada cacat" %>
          <span class="badge rounded-pill bg-warning"><%= loan.item.condition %></span>
        <% elsif loan.item.condition == "tidak layak pakai" %>
          <span class="badge rounded-pill bg-danger"><%= loan.item.condition %></span>
        <% end %>
        </td>
        <td class="col-sm-1"><%= loan.asset_loan.necessary %></td>
        <td class="col-sm-1">
          <%=
          if loan.admin.present?
            loan.admin.name
          else
            ""
          end
           %>
        </td>
        <td class="col-sm-1">
          <% if loan.loan_status == "accepted" %>
            <span class="badge rounded-pill bg-success"><%= loan.loan_status%></span>
          <% elsif loan.loan_status == "waiting" %>
            <span class="badge rounded-pill bg-warning"><%= loan.loan_status%></span>
          <% elsif loan.loan_status == "decline" %>
            <span class="badge rounded-pill bg-danger"><%= loan.loan_status%></span>
          <% end %>
        </td>
        <td class="col-sm-1"><%= loan.evidence %></td>
      </tr>
      <% end %>

  </tbody>
</table>
</div>
<%= paginate @loan_items, :window => 3 %>
</div>
</div>
